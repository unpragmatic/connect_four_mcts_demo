!function(){const t={COLUMNS:7,ROWS:6,ALL_COLUMNS_INDICES:[0,1,2,3,4,5,6],ALL_ROW_INDICES:[0,1,2,3,4,5],TURN_TO_TILE_MAP:{PLAYER_1_TURN:"PLAYER_1",PLAYER_2_TURN:"PLAYER_2"}};class e{constructor(){this.board=[["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"]],this.gameState="PLAYER_1_TURN",this.moveHistory=[],this.gameStateHistory=["PLAYER_1_TURN"]}isOver(){return"PLAYER_1_TURN"!=this.gameState&&"PLAYER_2_TURN"!=this.gameState}moveIsValid(e){return"EMPTY"==this.board[t.ROWS-1][e]}validMoves(){return t.ALL_COLUMNS_INDICES.filter((t=>this.moveIsValid(t)))}currentPlayer(){if(1===this.gameStateHistory.length)return"PLAYER_1";const t=this.gameStateHistory[this.gameState.length-2];return"PLAYER_1_TURN"===t?"PLAYER_2":"PLAYER_2_TURN"===t?"PLAYER_1":void 0}playerHasWon(t){return"PLAYER_1_WIN"===this.gameState&&"PLAYER_1"===t||"PLAYER_2_WIN"===this.gameState&&"PLAYER_2"===t}push(e){if(this.isOver())throw new Error("Invalid move. Game is already over.");if(!this.moveIsValid(e))throw new Error("Invalid move. Column is filled.");const s=Math.min(...t.ALL_ROW_INDICES.filter((t=>"EMPTY"==this.board[t][e])));this.board[s][e]=t.TURN_TO_TILE_MAP[this.gameState];const o=this._calculateUpdatedGameState(s,e);this.gameState=o,this.moveHistory.push(e),this.gameStateHistory.push(o)}pop(){if(0===this.moveHistory.length)throw new Error("Can't undo. No move to undo.");const e=this.moveHistory.pop();this.gameStateHistory.pop();const s=this.gameStateHistory[this.gameStateHistory.length-1],o=Math.max(...t.ALL_ROW_INDICES.filter((t=>"EMPTY"!=this.board[t][e])));this.board[o][e]="EMPTY",this.gameState=s}_calculateUpdatedGameState(e,s){const o=t=>{for(var e="EMPTY",s=0,o=0;o<t.length;o++)if(t[o]===e?s+=1:(e=t[o],s=1),4===s&&"EMPTY"!==e)return"PLAYER_1"===e?"PLAYER_1_WIN":"PLAYER_2_WIN"},r=o(t.ALL_ROW_INDICES.map((t=>this.board[t][s])));if(r)return r;const a=o(t.ALL_COLUMNS_INDICES.map((t=>this.board[e][t])));if(a)return a;var i=Math.min(e,s),n=s-i,h=e-i;const E=[];for(;n<t.COLUMNS&&h<t.ROWS;)E.push(this.board[h][n]),n+=1,h+=1;const M=o(E);if(M)return M;i=Math.min(t.COLUMNS-s,e),n=s+i,h=e-i;const P=[];for(;n>=0&&h<t.ROWS;)P.push(this.board[h][n]),n-=1,h+=1;const Y=o(P);return Y||(0==this.validMoves().length?"DRAW":"PLAYER_1_TURN"===this.gameState?"PLAYER_2_TURN":"PLAYER_1_TURN")}}class s{constructor(t){this.game=t,this.root=new r(t.validMoves(),void 0)}search(){if(this.game.isOver())return;var t=0;const e=performance.now();for(;performance.now()-e<1e3;){for(var s=0;s<2e3;s++)this.root._search(this.game,o(this.game));t+=2e3}return console.log(t),this.root.expSelectMove()}}function o(t){if("PLAYER_1_TURN"===t.gameState)return"PLAYER_1_WIN";if("PLAYER_2_TURN"===t.gameState)return"PLAYER_2_WIN";throw new Error("Unexpected conditions")}class r{constructor(t,e){this.move=e,this.wins=0,this.n=0,this.validMoves=t,this.moveToChildMap=[]}search(t){const e=o(t);t.push(this.move);const s=this._search(t,e);return t.pop(),s}getMoveChildPairs(){return this.validMoves.map((t=>[t,this.moveToChildMap[t]]))}ucbSelectMove(){const t=Math.sqrt(2);var e=void 0,s=-1/0;for(const[o,r]of this.getMoveChildPairs()){if(!r)return o;const a=r.wins/r.n+t*Math.sqrt(Math.log(this.n)/r.n);a>s&&(e=o,s=a)}return e}expSelectMove(){var t=void 0,e=-1/0;for(const[s,o]of this.getMoveChildPairs()){if(!o)continue;const r=o.wins/o.n;r>e&&(t=s,e=r)}return t}_search(t,e){if(this.n+=1,t.isOver())return t.gameState===e&&(this.wins+=1),t.gameState;const s=this.ucbSelectMove();var a=this.moveToChildMap[s];if(a){const s=a.search(t);return s===e&&(this.wins+=1),s}{const i=o(t);t.push(s);const n=t.validMoves();t.pop(),a=new r(n,s),this.moveToChildMap[s]=a,t.push(s);const h=function(t){for(var e=0;!t.isOver();){const s=t.validMoves(),o=s[Math.floor(Math.random()*s.length)];t.push(o),e+=1}const s=t.gameState;for(var o=0;o<e;o++)t.pop();return s}(t);return t.pop(),a.n+=1,h===i&&(a.wins+=1),h===e&&(this.wins+=1),h}}}onmessage=function(t){const o=new e;o.board=t.data.board,o.gameState=t.data.gameState,o.moveHistory=t.data.moveHistory,o.gameStateHistory=t.data.gameStateHistory;const r=new s(o).search();postMessage(r)}}();
//# sourceMappingURL=ai_worker.9e970cef.js.map
